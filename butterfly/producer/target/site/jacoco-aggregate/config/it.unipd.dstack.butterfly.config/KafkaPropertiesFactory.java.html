<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../../jacoco-resources/report.gif" type="image/gif"/><title>KafkaPropertiesFactory.java</title><link rel="stylesheet" href="../../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../../index.html" class="el_report">JaCoCo</a> &gt; <a href="../index.html" class="el_bundle">config</a> &gt; <a href="index.source.html" class="el_package">it.unipd.dstack.butterfly.config</a> &gt; <span class="el_source">KafkaPropertiesFactory.java</span></div><h1>KafkaPropertiesFactory.java</h1><pre class="source lang-java linenums">package it.unipd.dstack.butterfly.config;

import io.confluent.kafka.serializers.AbstractKafkaAvroSerDeConfig;
import io.confluent.kafka.serializers.KafkaAvroSerializer;
import org.apache.kafka.clients.producer.ProducerConfig;
import org.apache.kafka.common.serialization.StringSerializer;

import java.util.Properties;
<span class="nc" id="L9">public class KafkaPropertiesFactory {</span>

    /**
     * Provides the default property configuration for Apache Kafka.
     * See https://docs.confluent.io/current/installation/configuration/producer-configs.html
     * @return
     */
    public static Properties defaultKafkaPropertiesFactory() {
<span class="nc" id="L17">        Properties props = new Properties();</span>

        // A list of URLs to use for establishing the initial connection to the cluster.
<span class="nc" id="L20">        props.put(ProducerConfig.BOOTSTRAP_SERVERS_CONFIG,</span>
<span class="nc" id="L21">                  ConfigManager.getStringProperty(&quot;KAFKA_BOOTSTRAP_SERVERS_CONFIG&quot;));</span>

        // The producer will attempt to batch records together into fewer requests whenever multiple records are being
        // sent to the same partition. This helps performance on both the client and the server. This configuration
        // controls the default batch size in bytes.
        // No attempt will be made to batch records larger than this size.
<span class="nc" id="L27">        props.put(ProducerConfig.BATCH_SIZE_CONFIG,</span>
<span class="nc" id="L28">                  ConfigManager.getIntProperty(&quot;KAFKA_BATCH_SIZE_CONFIG&quot;));</span>

        // The total bytes of memory the producer can use to buffer records waiting to be sent to the server. If records
        // are sent faster than they can be delivered to the server the producer will block for max.block.ms after which
        // it will throw an exception.
<span class="nc" id="L33">        props.put(ProducerConfig.BUFFER_MEMORY_CONFIG,</span>
<span class="nc" id="L34">                  ConfigManager.getIntProperty(&quot;KAFKA_BUFFER_MEMORY_CONFIG&quot;));</span>

        // An ID string to pass to the server when making requests. The purpose of this is to be able to track the
        // source of requests beyond just ip/port by allowing a logical application name to be included in server-side
        // request logging.
<span class="nc" id="L39">        props.put(ProducerConfig.CLIENT_ID_CONFIG,</span>
<span class="nc" id="L40">                  ConfigManager.getStringProperty(&quot;KAFKA_CLIENT_ID_CONFIG&quot;));</span>

        // The compression type for all data generated by the producer. Compression is of full batches of data, so the
        // efficacy of batching will also impact the compression ratio (more batching means better compression).
<span class="nc" id="L44">        props.put(ProducerConfig.COMPRESSION_TYPE_CONFIG,</span>
<span class="nc" id="L45">                  ConfigManager.getStringProperty(&quot;KAFKA_COMPRESSION_TYPE_CONFIG&quot;, &quot;lz4&quot;));</span>

        // The base amount of time to wait before attempting to reconnect to a given host.
        // This avoids repeatedly connecting to a host in a tight loop.
        // This backoff applies to all connection attempts by the client to a broker.
<span class="nc" id="L50">        props.put(ProducerConfig.RETRY_BACKOFF_MS_CONFIG,</span>
<span class="nc" id="L51">                  ConfigManager.getIntProperty(&quot;KAFKA_RETRY_BACKOFF_MS_CONFIG&quot;, 1000));</span>

        // The number of acknowledgments the producer requires the leader to have received before considering a request
        // complete. This controls the durability of records that are sent.
<span class="nc" id="L55">        props.put(ProducerConfig.ACKS_CONFIG,</span>
<span class="nc" id="L56">                  ConfigManager.getStringProperty(&quot;KAFKA_ACKS_CONFIG&quot;, &quot;all&quot;));</span>

        // Setting a value greater than zero will cause the client to resend any record whose send fails with a
        // potentially transient error. Note that this retry is no different than if the client resent the record upon
        // receiving the error. Allowing retries without setting max.in.flight.requests.per.connection to 1 will
        // potentially change the ordering of records because if two batches are sent to a single partition, and the
        // first fails and is retried but the second succeeds, then the records in the second batch may appear first.
<span class="nc" id="L63">        props.put(ProducerConfig.RETRIES_CONFIG,</span>
<span class="nc" id="L64">                  ConfigManager.getIntProperty(&quot;KAFKA_RETRIES_CONFIG&quot;, 10));</span>

        // The configuration controls how long KafkaProducer.send() and KafkaProducer.partitionsFor() will block.
        // These methods can be blocked either because the buffer is full or metadata unavailable.Blocking in the
        // user-supplied serializers or partitioner will not be counted against this timeout.
<span class="nc" id="L69">        props.put(ProducerConfig.MAX_BLOCK_MS_CONFIG,</span>
<span class="nc" id="L70">                  ConfigManager.getIntProperty(&quot;KAFKA_MAX_BLOCK_MS_CONFIG&quot;, 600000));</span>

        // Serializer class for key that implements the org.apache.kafka.common.serialization.Serializer interface.
<span class="nc" id="L73">        props.put(ProducerConfig.KEY_SERIALIZER_CLASS_CONFIG,</span>
<span class="nc" id="L74">                StringSerializer.class.getName());</span>

        // Serializer class for value that implements the org.apache.kafka.common.serialization.Serializer interface.
<span class="nc" id="L77">        props.put(ProducerConfig.VALUE_SERIALIZER_CLASS_CONFIG,</span>
<span class="nc" id="L78">                  KafkaAvroSerializer.class.getName());</span>

<span class="nc" id="L80">        props.put(AbstractKafkaAvroSerDeConfig.SCHEMA_REGISTRY_URL_CONFIG,</span>
<span class="nc" id="L81">                  ConfigManager.getStringProperty(&quot;AVRO_SCHEMA_REGISTRY_URL&quot;));</span>

<span class="nc" id="L83">        return props;</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.3.201901230119</span>Code Coverage Report for JaCoCo 1.0-SNAPSHOT</div></body></html>